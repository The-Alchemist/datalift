<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>SPARQL Endpoint - Query results</title>
#header_links
</head>
<body>
#banner
#set($columnWidth = 100 / $it.Columns.size())
	<script>
		var gridData = new Array();
		var searchData = new Array();
		
		$(function(){
			jQuery.extend(jQuery.jgrid.defaults, {
				pager: $('#pagernav'),
				caption: $('#searchnav').html()
				
			});
			tableToGrid("#queryresults", {});
			$("#queryresults").trigger("reloadGrid");
			gridData = $("#queryresults").getRowData();

			// Function called when modifying search text
			$("#gridsearch").keyup(function () {
				gridSearch($(this).val().toLowerCase());
			});
			// Function called when modifying search Column
			$("#searchColumn").change(function() {
				gridSearch($("#gridsearch").val().toLowerCase());
			});
		});
		
		function gridSearch(searchString) {
			searchData = [];
			if ($("#searchColumn").val() == "all") {
				searchAllColumns(searchString);
			}
			else {
				searchOneColumn(searchString, $("#searchColumn").val());
			}
			$("#queryresults").jqGrid('clearGridData', true);
			$("#queryresults").jqGrid('setGridParam',{data:searchData}).trigger("reloadGrid");
		}		
		
		function searchAllColumns(searchString) {
			var c = 0;
			var obj = ["Subject", "Predicate", "Object"];
			for (var i = 0; i < gridData.length; i++) {
				for (var k = 0; k < obj.length; k++) {
					var toCmp = eval("gridData[i]." + obj[k]);
					if (toCmp.toLowerCase().indexOf(searchString) != -1) {
						searchData[c] = gridData[i];
						c++;
						k = obj.length;
					}
				}
			}
		}
		
		function searchOneColumn(searchString, searchColumn) {
			var c = 0;
			for (var i = 0; i < gridData.length; i++) {
				var toCmp = eval("gridData[i]." + searchColumn);
				if (toCmp.toLowerCase().indexOf(searchString) != -1) {
					searchData[c] = gridData[i];
					c++;
				}
			}
		}
		
	</script>

	<table id="queryresults" style="width:100%">
		<thead>
			<tr>
				<th>Subject</th>
				<th>Predicate</th>
				<th>Object</th>
			</tr>
		</thead>
		<tbody>
#foreach( $item in $it )
			<tr>
				<td>$esc.html($!{item.subject})</td>
				<td>$esc.html($!{item.predicate})</td>
				<td>$esc.html($!{item.object})</td>
			</tr>
#end
		</tbody>
	</table>
	<div id="pagernav"></div>
	<div id="searchnav" style="display:none">
		Column: <select id="searchColumn">
		<option id="all">all</option>
		<option id="Subject">Subject</option>
		<option id="Predicate">Predicate</option>
		<option id="Object">Object</option>
		</select>
		Search: <input type="search" id="gridsearch" placeholder="Search" results="0" class="gridsearch" />
	</div>
#footer
</body>
</html>
