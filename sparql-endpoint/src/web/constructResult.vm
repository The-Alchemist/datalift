#load("sparql/resources")
#load_core_resources
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>SPARQL Endpoint - #i18n("sparql.query.results")</title>
#header_links
</head>
<body>
#banner
#set($columnWidth = 100 / $it.Columns.size())
	<script>
		var gridData = new Array();
		var searchData = new Array();
		
		$(function(){
			jQuery.extend(jQuery.jgrid.defaults, {
				pager: $('#pagernav'),
				caption: $('#searchnav').html(),
				rowNum: 50,
				rowList:[50,100,200,500],
				search:{
					caption: #i18n("sparql.search.title")
				}
			});
			tableToGrid("#queryresults", {});
			$("#queryresults").trigger("reloadGrid");
			gridData = $("#queryresults").getRowData();

			// Function called when modifying search text
			$("#gridsearch").keyup(function () {
				gridSearch($(this).val().toLowerCase());
			});
			// Function called when modifying search Column
			$("#searchColumn").change(function() {
				gridSearch($("#gridsearch").val().toLowerCase());
			});
		});
		
		function gridSearch(searchString) {
			searchData = [];
			if ($("#searchColumn").val() == "#i18n("sparql.search.all_columns")") {
				searchAllColumns(searchString);
			}
			else {
				searchOneColumn(searchString, $("#searchColumn").val());
			}
			$("#queryresults").jqGrid('clearGridData', true);
			$("#queryresults").jqGrid('setGridParam',{data:searchData}).trigger("reloadGrid");
		}		
		
		function searchAllColumns(searchString) {
			var c = 0;
			var obj = ["#i18n("sparql.subject")", 
				   "#i18n("sparql.predicate")", 
				   "#i18n("sparql.object")"];
			for (var i = 0; i < gridData.length; i++) {
				for (var k = 0; k < obj.length; k++) {
					var toCmp = eval("gridData[i]." + obj[k]);
					if (toCmp.toLowerCase().indexOf(searchString) != -1) {
						searchData[c] = gridData[i];
						c++;
						k = obj.length;
					}
				}
			}
		}
		
		function searchOneColumn(searchString, searchColumn) {
			var c = 0;
			for (var i = 0; i < gridData.length; i++) {
				var toCmp = eval("gridData[i]." + searchColumn);
				if (toCmp.toLowerCase().indexOf(searchString) != -1) {
					searchData[c] = gridData[i];
					c++;
				}
			}
		}
		
	</script>

	<table id="queryresults" style="width:100%">
		<thead>
			<tr>
				<th>#i18n("sparql.subject")</th>
				<th>#i18n("sparql.predicate")</th>
				<th>#i18n("sparql.object")</th>
			</tr>
		</thead>
		<tbody>
#foreach( $item in $it )
			<tr>
#if( ${item.subject.startsWith("http://")} )
				<td><a href="$esc.url($!{item.subject})">$esc.html($!{item.subject})</a></td>
#else
				<td>$esc.html($!{item.subject})</td>
#end
				<td>$esc.html($!{item.predicate})</td>
#if( ${item.object.startsWith("http://")} )
				<td><a href="$esc.url($!{item.object})">$esc.html($!{item.subject})</a></td>
#else
				<td>$esc.html($!{item.object})</td>
#end
			</tr>
#end
		</tbody>
	</table>
	<div id="pagernav"></div>
	<div id="searchnav" style="display:none">
		#i18n("sparql.search.column") <select id="searchColumn">
		<option id="#i18n("sparql.search.column")">#i18n("sparql.search.column")</option>
		<option id="#i18n("sparql.subject")">#i18n("sparql.subject")</option>
		<option id="#i18n("sparql.predicate")">#i18n("sparql.predicate")</option>
		<option id="#i18n("sparql.object")">#i18n("sparql.object")</option>
		</select>
		#i18n("sparql.search.title") <input type="search" id="gridsearch" placeholder="Search" results="0" class="gridsearch" />
	</div>
#footer
</body>
</html>
